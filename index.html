<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KIDIQ | English Learning Channel</title>
  <link rel="icon" href="assets/favicon.jpg"> <!-- Ensure favicon is in a web-accessible folder -->
  <style>
    :root {
      --primary: #19a974;
      --accent: #ffb41e;
      --bg-light: #f6fafc;
      --bg-dark: #0a102a;
      --text: #112;
      --card-bg: #fff;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text);
      margin: 0; padding: 0; min-height:100vh;
      overflow-x: hidden;
      display: flex; flex-direction: column; align-items: center;
      position: relative;
      transition: background 0.5s, color 0.5s;
    }
    .animated-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      z-index: -1;
    }
    body.light .animated-bg {
      background: linear-gradient(to bottom, #87cefa, #f6fafc);
      animation: skyDay 20s linear infinite alternate;
    }
    body.dark .animated-bg {
      background: linear-gradient(to bottom, #0a102a, #233560);
      animation: skyNight 25s linear infinite alternate;
    }
    .sun, .moon {
      position: absolute;
      border-radius: 50%;
      animation: floatAcross 40s linear infinite;
      top: 10%;
      left: -10%;
    }
    .sun {
      width: 80px; height: 80px;
      background: #ffdd55;
      box-shadow: 0 0 60px #ffd;
    }
    .moon {
      width: 60px; height: 60px;
      background: #fff;
      box-shadow: 0 0 30px #eef;
      top: 20%;
    }
    .cloud {
      position: absolute; background: #fff;
      border-radius: 50%;
      opacity: 0.8;
      animation: cloudMove 60s linear infinite;
    }
    .cloud::before, .cloud::after {
      content: "";
      position: absolute; background: #fff; border-radius: 50%;
    }
    .cloud::before { width: 60px; height: 60px; left: -30px; top: -20px; }
    .cloud::after { width: 70px; height: 70px; left: 40px; top: -10px; }
    .star {
      position: absolute;
      width: 2px; height: 2px;
      background: #fff;
      border-radius: 50%;
      opacity: 0.7;
      animation: twinkle 3s infinite alternate;
      display: none;
    }
    @keyframes floatAcross { from{ left:-10%; } to{ left:110%; } }
    @keyframes cloudMove { from{ left:-20%; } to{ left:120%; } }
    @keyframes skyDay { from{ filter:brightness(1); } to{ filter:brightness(1.1); } }
    @keyframes skyNight { from{ filter:brightness(0.7); } to{ filter:brightness(0.9); } }
    @keyframes twinkle { from{ opacity:0.3; } to{ opacity:1; } }
    header {
      margin: 2rem 0 1rem 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
    }
    #logo {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border-radius: 20%;
      background: #fff;
      box-shadow: 0 2px 16px rgba(0,0,0,0.07);
    }
    h1 {
      margin: 1rem 0 0.4rem 0;
      font-size: 2rem;
      color: var(--primary);
      text-shadow: 0 2px 4px #fff7;
    }
    .tagline {
      color: #555;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .buttons {
      display: flex;
      gap: 0.7rem;
      margin-bottom: 1.3rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .buttons a, #themeToggle, #editProfileBtn, #audioBtnPhrase, #audioBtnIdiom {
      background: var(--primary);
      color: #fff;
      padding: 0.7rem 1.3rem;
      text-decoration: none;
      font-weight: 600;
      border-radius: 24px;
      box-shadow: 0 2px 8px #19a97433;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.3s;
      border: none;
      cursor: pointer;
    }
    .buttons a:hover, #themeToggle:hover, #editProfileBtn:hover, #audioBtnPhrase:hover, #audioBtnIdiom:hover {
      background: var(--accent);
      color: #222;
    }
    main {
      max-width: 500px;
      width: 95vw;
      margin: 0 auto;
      z-index: 2;
    }
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 4px 24px #0002;
      padding: 1.6rem 1.2rem;
      margin-bottom: 1.7rem;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s forwards;
      transition: background 0.4s;
    }
    .card h2 {
      margin-top: 0;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.4em;
      font-size: 1.3rem;
    }
    .card p {
      font-size: 1rem;
      margin: 0.5rem 0;
    }
    .card button {
      background: var(--primary);
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      cursor: pointer;
    }
    .card button:hover {
      background: var(--accent);
      color: #222;
    }
    .flashcard {
      width: 150px;
      height: 100px;
      perspective: 1000px;
      margin: 1em auto;
      cursor: pointer;
      position: relative;
    }
    .flashcard div {
      width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      transition: transform 0.6s;
      font-weight: bold;
    }
    .flashcard .front {
      background: var(--primary);
      color: #fff;
    }
    .flashcard .back {
      background: var(--accent);
      color: #222;
      transform: rotateY(180deg);
    }
    .flashcard.flip .front {
      transform: rotateY(180deg);
    }
    .flashcard.flip .back {
      transform: rotateY(360deg);
    }
    #streakBox {
      position: fixed; top: 8px; right: 8px; background: #fff;
      padding: 6px 12px;
      border-radius: 8px; box-shadow: 0 2px 6px #0002;
      font-weight: 600; z-index: 999;
      text-align: center;
      font-size: 1rem;
      min-width: 140px;
    }
    body.dark #streakBox {
      background: #222;
      color: #ffb41e;
    }
    #xpBarWrapper {
      background: #ddd;
      border-radius: 10px;
      height: 14px;
      margin-top: 6px;
    }
    #xpBar {
      background: var(--primary);
      height: 100%;
      border-radius: 10px;
      width: 0%;
      transition: width 0.3s;
    }
    #dictPopup {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px #0004;
      display: none;
      max-width: 320px;
      z-index: 1000;
    }
    #profileCard {
      text-align: center;
      margin-bottom: 1.7rem;
    }
    #avatarDisplay {
      font-size: 3rem;
      cursor: pointer;
    }
    #profileName {
      font-weight: 600;
      font-size: 1.3rem;
      margin: 0.2rem 0;
    }
    #editProfileBtn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 24px;
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 2px 8px #19a97433;
      transition: background 0.3s;
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 40px;
    }
    #editProfileBtn:hover {
      background: var(--accent);
      color: #222;
    }
    #badgeDisplay {
      margin-top: 10px;
      font-weight: 600;
      color: var(--primary);
      font-size: 1rem;
    }
    #progressHistory {
      margin-top: 12px;
      font-size: 0.95rem;
      color: #555;
    }
    #requestReportBtn {
      margin-top: 10px;
      background: var(--accent);
      color: #222;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      padding: 0.5rem 1rem;
      box-shadow: 0 2px 8px #ffb41e99;
      transition: background 0.3s;
    }
    #requestReportBtn:hover {
      background: var(--primary);
      color: #fff;
    }
    #quizCard.disabled {
      opacity: 0.6;
      pointer-events: none;
      user-select: none;
    }
    #wordOfDay {
      font-size: 1.1rem;
      margin-top: 0.5rem;
    }
    @keyframes fadeInUp { to { opacity:1; transform:translateY(0); } }
    /* Feedback Section Styles */
    #feedbackForm input, #feedbackForm textarea {
      width: 100%;
      padding: 0.6rem;
      margin: 0.4rem 0;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
    }
    #feedbackForm textarea { min-height:80px; resize:none; }
    #feedbackForm button, #confirmRating {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px #19a97433;
      transition: background 0.3s;
    }
    #feedbackForm button:hover, #confirmRating:hover { background: var(--accent); color:#222; }
    #starRating span { transition: color 0.2s; cursor: pointer; }
    #starRating span.filled { color: gold; }
  </style>
</head>
<body class="light">
  <div class="animated-bg" id="animatedBg">
    <div class="sun" id="bgSun"></div>
    <div class="moon" id="bgMoon" style="display:none;"></div>
    <div class="cloud" style="top:20%; left:10%; width:100px; height:50px;"></div>
    <div class="cloud" style="top:40%; left:60%; width:120px; height:60px;"></div>
    <div class="star" style="top:15%; left:30%;"></div>
    <div class="star" style="top:25%; left:70%;"></div>
    <div class="star" style="top:50%; left:50%;"></div>
    <div class="star" style="top:70%; left:20%;"></div>
  </div>
  <button id="themeToggle" title="Switch theme" style="position:fixed;top:10px;left:14px;z-index:1001;" tabindex="0" aria-label="Switch theme">üåõ</button>
  <header role="banner">
    <img src="assets/logo.jpg" alt="KIDIQ Logo" id="logo">
    <h1>KIDIQ</h1>
    <div class="tagline">TIME TO LEARN ENGLISH</div>
    <div class="buttons">
      <a href="https://wa.me/YOURWHATSAPPGROUPLINK" target="_blank" tabindex="0" aria-label="WhatsApp">CHANNEL</a>
      <a href="https://wa.me/?text=Join%20me%20for%20daily%20English%20lessons%20at%20KIDIQ%3A%20YOURSITEURL" target="_blank" tabindex="0" aria-label="Share channel link">SHARE</a>
      <a href="#" id="msgBtn" tabindex="0" aria-label="Message">MESSAGE</a>
    </div>
  </header>
  <main>
    <div class="card" id="profileCard">
      <div id="avatarDisplay" title="Click to change avatar" tabindex="0" aria-pressed="false" role="button">üê±</div>
      <div id="profileName">Guest</div>
      <button id="editProfileBtn" tabindex="0" aria-label="Edit Profile">EDIT PROFILE </button>
      <div id="profileStats">
        <span id="profileStreak"></span><br>
        <span id="profileXP"></span>
        <div id="badgeDisplay">üèÖ Badges: None</div>
      </div>
      <div id="progressHistory">üìä Progress History: (coming soon)</div>
      <button id="requestReportBtn" tabindex="0" aria-label="Request Progress Report">Request Progress Report</button>
    </div>
    <div class="card">
      <h2>üìñ Phrase of the Day</h2>
      <p>It‚Äôs <span class="clickWord" data-fr="pleut beaucoup" style="cursor:pointer; color:var(--primary);">raining</span> cats and dogs.</p>
      <button id="audioBtnPhrase" tabindex="0" aria-label="Listen Phrase of the Day">üîä Listen</button>
    </div>
    <div class="card">
      <h2>‚ú® Idiom</h2>
      <p>Break a <span class="clickWord" data-fr="jambe" style="cursor:pointer; color:var(--primary);">leg</span>!</p>
      <button id="audioBtnIdiom" tabindex="0" aria-label="Listen Idiom">üîä Listen</button>
    </div>
    <div class="card">
      <h2>Flashcard</h2>
      <div class="flashcard" id="flashcard" tabindex="0" role="button" aria-pressed="false" aria-label="Flashcard: click or press enter to flip">
        <div class="front">üê± Cat</div>
        <div class="back">Chat (FR)</div>
      </div>
    </div>
    <div class="card">
      <h2>üå± Word of the Day</h2>
      <div id="wordOfDay" aria-live="polite"></div>
    </div>
    <div class="card" id="quoteCard" aria-live="polite">
      <h2>Motivation</h2>
      <div id="quoteText"></div>
    </div>
    <div class="card" id="quizCard" aria-live="polite">
      <h2>Mini Quiz</h2>
      <div id="quizQ"></div>
      <div id="quizOpts"></div>
      <div id="quizResult" style="margin-top:0.5rem;font-weight:bold;" aria-live="assertive"></div>
    </div>
    <div class="card" style="text-align:center;">
      <h2>Your Progress</h2>
      <div id="xpBarWrapper" aria-label="Experience progress bar" style="margin-bottom:0.6rem;">
        <div id="xpBar"></div>
      </div>
      <div id="userLevel" style="font-weight:600; font-size:1.1rem; color:var(--primary);"></div>
    </div>
    <div class="card" id="feedbackCard" aria-live="polite">
      <h2>üì¨ Send Feedback</h2>
      <form id="feedbackForm">
        <input type="text" id="fbName" placeholder="Name (optional)" aria-label="Name" />
        <input type="text" id="fbSurname" placeholder="Surname (optional)" aria-label="Surname" />
        <input type="email" id="fbEmail" placeholder="Email (optional)" aria-label="Email" />
        <textarea id="fbMessage" placeholder="Your message..." aria-label="Message" required></textarea>
        <button type="submit">Send Feedback</button>
      </form>
      <div id="feedbackSuccess" style="display:none; margin-top:10px; font-weight:600; color:var(--primary);">
        ‚úÖ Thanks! Your feedback has been sent.
      </div>
      <h2 style="margin-top:2rem;">‚≠ê Rate the Bot</h2>
      <div id="starRating" style="font-size:1.5rem; cursor:pointer;">
        <span data-star="1">‚òÜ</span>
        <span data-star="2">‚òÜ</span>
        <span data-star="3">‚òÜ</span>
        <span data-star="4">‚òÜ</span>
        <span data-star="5">‚òÜ</span>
      </div>
      <button id="confirmRating" style="margin-top:0.5rem;">Confirm Rate</button>
      <div id="ratingSuccess" style="display:none; margin-top:10px; font-weight:600; color:var(--primary);"></div>
    </div>
  </main>
  <div id="streakBox" aria-live="polite"></div>
  <div id="dictPopup"></div>

  <script>
    // 1. THEME & BACKGROUND
    const body = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const sun = document.getElementById("bgSun");
    const moon = document.getElementById("bgMoon");
    const bgStars = document.querySelectorAll(".star");

    let theme = localStorage.getItem("theme") || "light";
    setTheme(theme);
    themeToggle.onclick = () => {
      theme = (theme === "light") ? "dark" : "light";
      setTheme(theme);
    };
    function setTheme(mode) {
      if (mode === "dark") {
        body.classList.add("dark");
        body.classList.remove("light");
        themeToggle.textContent = "üåû";
        sun.style.display = "none";
        moon.style.display = "block";
        bgStars.forEach(s => s.style.display = "block");
      } else {
        body.classList.add("light");
        body.classList.remove("dark");
        themeToggle.textContent = "üåõ";
        sun.style.display = "block";
        moon.style.display = "none";
        bgStars.forEach(s => s.style.display = "none");
      }
      localStorage.setItem("theme", mode);
    }

    // 2. PROFILE MANAGEMENT
    const avatarDisplay = document.getElementById('avatarDisplay');
    const profileName = document.getElementById('profileName');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const profileStreak = document.getElementById('profileStreak');
    const profileXP = document.getElementById('profileXP');

    function loadProfile() {
      profileName.textContent = localStorage.getItem('profileName') || "Guest";
      avatarDisplay.textContent = localStorage.getItem('avatar') || "üê±";
      profileStreak.textContent = `üî• Current Streak: ${localStorage.getItem('studyStreak') || 0} day(s)`;
      profileXP.textContent = `‚≠ê Total XP: ${localStorage.getItem('totalXP') || 0}`;
    }
    function saveProfile(name, avatar) {
      localStorage.setItem('profileName', name);
      localStorage.setItem('avatar', avatar);
      loadProfile();
    }
    loadProfile();
    editProfileBtn.onclick = () => {
      let nameInput = prompt("ENTER YOUR NAME:", profileName.textContent);
      let avatarInput = prompt("Choose an emoji for your avatar (e.g. üê± üåü üçÄ):", avatarDisplay.textContent);
      let name = (nameInput === null) ? profileName.textContent : nameInput;
      let avatar = (avatarInput === null) ? avatarDisplay.textContent : avatarInput;
      saveProfile(name, avatar);
    };

    // 3. STREAK LOGIC
    const streakKey = "studyStreak", lastVisitKey = "lastVisit";
    let streak = parseInt(localStorage.getItem(streakKey)) || 0;
    const lastVisit = localStorage.getItem(lastVisitKey);
    const today = new Date().toDateString();
    if (lastVisit !== today) {
      streak = (lastVisit && (new Date(lastVisit).getTime() + 86400000 === new Date(today).getTime())) ? streak + 1 : 1;
      localStorage.setItem(streakKey, streak);
      localStorage.setItem(lastVisitKey, today);
    }
    document.getElementById("streakBox").textContent = `üî• Streak: ${streak} day${streak > 1 ? 's' : ''}`;
    profileStreak.textContent = `üî• Current Streak: ${streak} day(s)`;

    // 4. FLASHCARD
    const flashcard = document.getElementById("flashcard");
    flashcard.onclick = () => {
      flashcard.classList.toggle("flip");
      let pressed = flashcard.getAttribute('aria-pressed') === 'true';
      flashcard.setAttribute('aria-pressed', (!pressed).toString());
    };
    flashcard.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        flashcard.classList.toggle("flip");
        let pressed = flashcard.getAttribute('aria-pressed') === 'true';
        flashcard.setAttribute('aria-pressed', (!pressed).toString());
      }
    });

    // 5. AUDIO LESSONS
    const audioBtnPhrase = document.getElementById("audioBtnPhrase");
    const audioBtnIdiom = document.getElementById("audioBtnIdiom");
    audioBtnPhrase.onclick = () => {
      if (window.speechSynthesis) {
        const u = new SpeechSynthesisUtterance("It's raining cats and dogs.");
        u.lang = 'en-US'; u.rate = 0.98;
        window.speechSynthesis.speak(u);
      }
    };
    audioBtnIdiom.onclick = () => {
      if (window.speechSynthesis) {
        const u = new SpeechSynthesisUtterance("Break a leg!");
        u.lang = 'en-US'; u.rate = 0.98;
        window.speechSynthesis.speak(u);
      }
    };

    // 6. DICTIONARY POPUP
    document.querySelectorAll('.clickWord').forEach(el => {
      el.style.cursor = 'pointer';
      el.style.color = 'var(--primary)';
      el.onclick = () => {
        const dictPopup = document.getElementById("dictPopup");
        dictPopup.style.display = 'block';
        dictPopup.innerHTML = `<b>${el.textContent}</b><br>Translation: ${el.dataset.fr}`;
        setTimeout(() => dictPopup.style.display = 'none', 4000);
      };
    });

    // 7. DAILY QUOTE
    const quotes = [
      "Learning never exhausts the mind.",
      "The secret of getting ahead is getting started.",
      "A new language is a new life."
    ];
    document.getElementById("quoteText").textContent = quotes[Math.floor(Math.random() * quotes.length)];

       // 8. MINI QUIZ & XP/PROGRESS BAR
    const quizData = [
      {q: "What is the synonym of 'Happy'?", opts:["Sad","Joyful","Angry"], ans:1},
      {q: "Which is a fruit?", opts:["Carrot","Apple","Broccoli"], ans:1},
      {q: "What color is the sky?", opts:["Blue","Green","Red"], ans:0},
      {q: "How many legs does a spider have?", opts:["6","8","10"], ans:1},
      {q: "Water freezes at 0 on which scale?", opts:["Fahrenheit","Celsius","Kelvin"], ans:1},
      {q: "What is the opposite of 'Hot'?", opts:["Cold","Warm","Cool"], ans:0},
      {q: "Which animal barks?", opts:["Cat","Dog","Bird"], ans:1},
      {q: "How many letters in 'English'?", opts:["6","7","8"], ans:1},
      {q: "What is the first month of the year?", opts:["January","March","December"], ans:0},
      {q: "What color are bananas?", opts:["Red","Yellow","Purple"], ans:1}
    ];
    const quizQ = document.getElementById("quizQ");
    const quizOpts = document.getElementById("quizOpts");
    const quizResult = document.getElementById("quizResult");
    const userLevel = document.getElementById("userLevel");
    const quizCard = document.getElementById("quizCard");
    const xpBar = document.getElementById("xpBar");

    let currentQuestionIndex = 0;
    let score = 0;
    let totalXP = parseInt(localStorage.getItem('totalXP')) || 0;

    showQuestion(currentQuestionIndex);
    updateXP(totalXP);
    updateLevel(totalXP);

    function showQuestion(index) {
      clearQuizResult();
      if(index < quizData.length){
        quizQ.textContent = quizData[index].q;
        quizOpts.innerHTML = "";
        quizData[index].opts.forEach((option, i) => {
          const btn = document.createElement('button');
          btn.textContent = option;
          btn.style.margin = '0.3rem';
          btn.setAttribute('tabindex', '0');
          btn.onclick = () => handleAnswer(i);
          quizOpts.appendChild(btn);
        });
      }
    }
    function handleAnswer(selection) {
      const correctIndex = quizData[currentQuestionIndex].ans;
      if(selection === correctIndex) {
        quizResult.textContent = "‚úÖ Correct!";
        score++;
        totalXP += 2;
        showXPNotification('+2 XP! Correct Answer üéâ');
      } else {
        quizResult.textContent = "‚ùå Try again.";
      }
      saveTotalXP(totalXP);
      updateXP(totalXP);
      updateLevel(totalXP);
      setTimeout(() => {
        currentQuestionIndex++;
        if(currentQuestionIndex < quizData.length) {
          showQuestion(currentQuestionIndex);
        } else {
          quizComplete();
        }
      }, 1200);
    }

    function clearQuizResult() {
      quizResult.textContent = "";
    }
    function saveTotalXP(xp) {
      localStorage.setItem('totalXP', xp);
      profileXP.textContent = `‚≠ê Total XP: ${xp}`;
    }
    function updateXP(points) {
      let pct = Math.min(100, (points % 100));
      xpBar.style.width = pct + '%';
    }
    function updateLevel(points) {
      let levelMsg = "";
      if(currentQuestionIndex >= quizData.length) {
        levelMsg = finalizeMessage(score, quizData.length);
        quizCard.classList.add('disabled');
      } else {
        levelMsg = `Current Score: ${score}/${currentQuestionIndex}`;
      }
      userLevel.textContent = levelMsg;
    }
    function finalizeMessage(scored, totalQuestions) {
      const maxScore = totalQuestions;
      if(scored === maxScore) {
        return `üéâ Wonderful, congratulations! You've finished today's lesson with a perfect score of ${scored}/${maxScore} üëè See you tomorrow üòÅ`;
      } else if(scored >= 8) {
        return `üåü Great job! Your score is ${scored}/${maxScore} üëè Keep it up!`;
      } else if(scored >= 6) {
        return `üëç Good effort! Your score is ${scored}/${maxScore} üëè You can do even better!`;
      } else if(scored >= 4) {
        return `üòä Keep trying! Your score is ${scored}/${maxScore} üëè Practice makes perfect!`;
      } else {
        return `üòï Your score is ${scored}/${maxScore} üëè Don't give up, keep learning!`;
      }
    }
    function quizComplete() {
      quizOpts.innerHTML = "";
      quizQ.textContent = "üéâ Quiz Completed For Today. Come back tomorrow for more!";
      quizResult.textContent = finalizeMessage(score, quizData.length);
      quizCard.classList.add('disabled');
      updateLevel(totalXP);
    }

    // --- Feedback Form ---
    const feedbackForm = document.getElementById('feedbackForm');
    const feedbackSuccess = document.getElementById('feedbackSuccess');

    feedbackForm.onsubmit = (e) => {
      e.preventDefault();
      const name = document.getElementById('fbName').value;
      const surname = document.getElementById('fbSurname').value;
      const email = document.getElementById('fbEmail').value;
      const message = document.getElementById('fbMessage').value;

      if(!message.trim()) return alert("Message cannot be empty!");

      let feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
      feedbacks.push({name, surname, email, message, date: new Date().toISOString()});
      localStorage.setItem('feedbacks', JSON.stringify(feedbacks));

      feedbackForm.reset();
      feedbackSuccess.style.display = "block";
      setTimeout(() => feedbackSuccess.style.display = "none", 4000);
    };

    // --- Star Rating ---
    const ratingStars = document.querySelectorAll('#starRating span');
    let selectedRating = 0;

    ratingStars.forEach(star => {
      star.onclick = () => {
        selectedRating = parseInt(star.dataset.star);
        updateStars(selectedRating);
      };
      star.onmouseover = () => updateStars(parseInt(star.dataset.star));
      star.onmouseout = () => updateStars(selectedRating);
    });

    function updateStars(rating) {
      ratingStars.forEach(s => {
        s.classList.remove('filled');
        if(parseInt(s.dataset.star) <= rating) s.classList.add('filled');
      });
    }

    // --- Confirm Rating ---
    const confirmRatingBtn = document.getElementById('confirmRating');
    const ratingSuccess = document.getElementById('ratingSuccess');

    confirmRatingBtn.onclick = () => {
      if(selectedRating === 0) return alert("Please select a rating first!");
      localStorage.setItem('botRating', selectedRating);
      ratingSuccess.textContent = `Thanks! You rated the bot ${selectedRating}/5 ‚≠ê`;
      ratingSuccess.style.display = "block";
      setTimeout(() => ratingSuccess.style.display = "none", 4000);
    };

    // --- Sparkle Effect ---
    function addSparkle(notif) {
      const sparkleCount = 10;
      for (let i = 0; i < sparkleCount; i++) {
        const sparkle = document.createElement('div');
        sparkle.style.position = 'absolute';
        sparkle.style.width = sparkle.style.height = (Math.random() * 6 + 4) + 'px';
        sparkle.style.background = '#fff';
        sparkle.style.borderRadius = '50%';
        sparkle.style.left = Math.random() * notif.offsetWidth + 'px';
        sparkle.style.top = Math.random() * notif.offsetHeight + 'px';
        sparkle.style.opacity = Math.random();
        sparkle.style.pointerEvents = 'none';
        sparkle.style.transform = `scale(${Math.random()})`;
        sparkle.style.filter = 'blur(1px)';
        notif.appendChild(sparkle);

        sparkle.animate([
          { transform: 'translateY(0) scale(0.5)', opacity: 1 },
          { transform: `translateY(-${Math.random()*20 + 10}px) scale(1)`, opacity: 0 }
        ], { duration: 800 + Math.random()*400, iterations: 1 });

        setTimeout(() => {
          if (notif.contains(sparkle)) notif.removeChild(sparkle);
        }, 1200);
      }
    }

    // --- XP Notification with Confetti + Sparkle ---
    function showXPNotification(message) {
      showConfetti();

      const notif = document.createElement('div');
      notif.textContent = message;
      notif.style.position = 'fixed';
      notif.style.bottom = '120px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.background = 'var(--primary)';
      notif.style.color = '#fff';
      notif.style.padding = '0.5rem 1rem';
      notif.style.borderRadius = '24px';
      notif.style.fontWeight = '600';
      notif.style.zIndex = 9999;
      notif.style.opacity = 1;
      notif.style.transition = 'all 2s ease-out';
      notif.style.textAlign = 'center';
      notif.style.position = 'relative';
      document.body.appendChild(notif);

      addSparkle(notif);

      setTimeout(() => {
        notif.style.bottom = '180px';
        notif.style.opacity = 0;
      }, 50);

      setTimeout(() => {
        document.body.removeChild(notif);
      }, 2050);
    }

    function showConfetti() {
      console.log('Confetti!');
    }
  </script>
</body>
</html>
